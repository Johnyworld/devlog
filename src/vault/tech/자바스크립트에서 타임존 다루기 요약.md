# 자바스크립트에서 타임존 다루기 요약

_2023년 2월 6일_

## 서버 - 클라이언트 환경에서의 타임존

다양한 타임존의 클라이언트 환경을 지원하기 위해서는 서버에 저장되는 데이터가 타임존에 영향을 받지 않는 절대값이어야 한다. 이를 위해서는 클라이언트에서 서버에 전달하는 날짜 및 시간 정보가 동일한 오프셋(보통 UTC)에 맞추어진 값이거나, 해당 클라이언트 환경의 타임존 정보까지 포함된 값이어야 할 것이다.

일반적으로 이런 데이터는 UTC를 기준으로 한 [유닉스 시간](https://en.wikipedia.org/wiki/Unix_time)이나 오프셋 정보가 포함된 [ISO-8601](https://en.wikipedia.org/wiki/ISO_8601)와 같은 형태로 전송하게 된다.

- ISO-8601 : `2017-03-10T11:30:00+09:00`
- 유닉스 : `1489113000`

## 자바스크립트의 Date 객체

자바스크립트의 Date 객체는 내부적으로 유닉스 시간과 같은 절대값으로 시간 데이터를 관리한다. 하지만 생성자나 `parse()` 함수, `getHour()`, `setHour()` 등의 메소드들은 모두 **클라이언트의 로컬 타임존 (정확히는 브라우저가 실행되는 운영체제에 설정된 타임존)에 영향을 받는다.** 그러므로 사용자가 입력한 데이터를 이용해 그대로 Date 객체를 생성하거나 값을 지정한다면 그 데이터는 클라이언트의 로컬 타임존을 그대로 반영하게 될 것이다.

> 자바스크립트는 임의로 타임존을 변경할 수 있는 방법을 제공하지 않는다.

## 사용자의 입력값을 이용한 Date 객체 생성

[MDN의 Date.parse() 문서](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/parse)에도 나와있듯이, `parse` 메소드의 결과값은 브라우저마다 구현상태가 다르고, 문자열의 형태에 따라 정확한 값을 예측하기 어렵기 때문에 사용하지 않기를 권장하고 있다.

예를 들어 `2015-10-12 12:00:00` 같은 문자열은 사파리나 IE의 경우 `NaN` 을 반환하고, 크롬이나 파이어폭스의 경우 로컬 타임존의 값을 반환하며, 경우에 따라 다른 환경에서는 UTC 기준의 값을 반환하기도 한다.

## 서버 데이터를 이용한 Date 객체 생성

만약 데이터가 숫자형의 유닉스 시간값이라면, 간단하게 생성자를 이용해서 Date 객체를 생성할 수 있다. 그러면 유닉스 시간이 아닌 ISO-8601과 같은 문자열 타입은 어떨까?

브라우저 버전별로 다르게 해석되는 문제를 막기 위해서는 **타임존 데이터가 없는 경우 문자열의 마지막에 항상 `Z`를 추가**해 주어야 한다.

```js
var d1 = new Date('2017-03-11T11:30:00');
var d2 = new Date('2017-03-11T11:30:00Z');
d1.toString(); // "Sat Mar 11 11:30:00 UTC+0900 2017"
d2.toString(); // "Sat Mar 11 20:30:00 UTC+0900 2017"
```

## 서버로 전달할 데이터 생성

서버로 다시 데이터를 전송하기 위해서는 데이터를 변환하는 과정이 필요하다. 

- 유닉스 시간 형식의 경우 `getTime()` 메소드를 이용해서 간단하게 수행할 수 있다. 
- ISO-8601 형식의 문자열은 어떨까? `toISOString()` 나 `toJSON()` 메소드를 이용하면 ISO-8601 형식의 문자열을 생성할 수 있다.

Date 객체에는 `toString()`, `toLocaleString()` 및 이들의 확장 메소드들이 더 있지만, 주로 로컬 타임존 기준의 문자열을 반환하는 목적으로 사용되고, 특히 브라우저나 OS 환경에 따라 같은 결과가 보장되지 않기 때문에 사실상 별로 유용하지 않다.





### 출처
- [자바스크립트에서 타임존 다루기 1](https://meetup.nhncloud.com/posts/125)
- [자바스크립트에서 타임존 다루기 2](https://meetup.nhncloud.com/posts/130)
